[DB] Initializing Supabase client. Service Role Key present: true
--- Listing Existing Departments ---
[
  {
    id: 74,
    name: 'City Disaster Risk Reduction and Management Office',
    code: 'CDRRMO',
    description: 'Emergency response and disaster management',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'cdrrmo@digoscity.gov.ph', phone: '(082) 553-1239' },
    response_time_hours: 6,
    escalation_time_hours: 12
  },
  {
    id: 75,
    name: 'City Environment and Natural Resources Office',
    code: 'ENRO',
    description: 'Environmental protection and natural resources management',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'enro@digoscity.gov.ph', phone: '(082) 553-1240' },
    response_time_hours: 24,
    escalation_time_hours: 48
  },
  {
    id: 76,
    name: "City Treasurer's Office",
    code: 'CTO',
    description: 'Tax collection and revenue management',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'cto@digoscity.gov.ph', phone: '(082) 553-1241' },
    response_time_hours: 24,
    escalation_time_hours: 48
  },
  {
    id: 69,
    name: 'City Engineering Office',
    code: 'CEO',
    description: 'Roads, construction, and infrastructure maintenance',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'ceo@digoscity.gov.ph', phone: '(082) 553-1234' },
    response_time_hours: 24,
    escalation_time_hours: 72
  },
  {
    id: 70,
    name: 'City General Services Office',
    code: 'GSO',
    description: 'Facilities and maintenance services',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'gso@digoscity.gov.ph', phone: '(082) 553-1235' },
    response_time_hours: 48,
    escalation_time_hours: 96
  },
  {
    id: 71,
    name: 'City Planning and Development Coordinator',
    code: 'CPDC',
    description: 'Land use planning and development coordination',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'cpdc@digoscity.gov.ph', phone: '(082) 553-1236' },
    response_time_hours: 72,
    escalation_time_hours: 120
  },
  {
    id: 72,
    name: 'Digos City Health Office',
    code: 'CHO',
    description: 'Public health and medical services',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'cho@digoscity.gov.ph', phone: '(082) 553-1237' },
    response_time_hours: 12,
    escalation_time_hours: 24
  },
  {
    id: 73,
    name: 'City Social Welfare and Development Office',
    code: 'CSWDO',
    description: 'Social welfare and community development',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'cswdo@digoscity.gov.ph', phone: '(082) 553-1238' },
    response_time_hours: 24,
    escalation_time_hours: 48
  },
  {
    id: 77,
    name: 'City Economic Enterprise Office',
    code: 'CEEO',
    description: 'Economic development and enterprise support',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'ceeo@digoscity.gov.ph', phone: '(082) 553-1242' },
    response_time_hours: 48,
    escalation_time_hours: 96
  },
  {
    id: 78,
    name: 'Human Resource Management Office',
    code: 'HRMO',
    description: 'Personnel management and staff services',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'hrmo@digoscity.gov.ph', phone: '(082) 553-1243' },
    response_time_hours: 24,
    escalation_time_hours: 48
  },
  {
    id: 79,
    name: 'Philippine National Police - Digos City Station',
    code: 'PNP',
    description: 'Police services and law enforcement',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'NGA',
    contact_info: {
      email: 'pnp.digos@philnationalpolice.gov.ph',
      phone: '(082) 553-1244'
    },
    response_time_hours: 2,
    escalation_time_hours: 6
  },
  {
    id: 80,
    name: 'City Legal Office',
    code: 'CLO',
    description: 'Legal services and investigation',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'clo@digoscity.gov.ph', phone: '(082) 553-1245' },
    response_time_hours: 48,
    escalation_time_hours: 96
  },
  {
    id: 81,
    name: 'Office of the City Mayor',
    code: 'OCM',
    description: 'Executive oversight and city administration',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'mayor@digoscity.gov.ph', phone: '(082) 553-1246' },
    response_time_hours: 72,
    escalation_time_hours: 120
  },
  {
    id: 82,
    name: 'Public Assistance Desk',
    code: 'PAD',
    description: 'Frontline citizen assistance and support',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'pad@digoscity.gov.ph', phone: '(082) 553-1247' },
    response_time_hours: 4,
    escalation_time_hours: 8
  },
  {
    id: 83,
    name: 'Office of the City Administrator',
    code: 'OCA',
    description: 'Complaint routing and administrative coordination',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'oca@digoscity.gov.ph', phone: '(082) 553-1248' },
    response_time_hours: 24,
    escalation_time_hours: 48
  },
  {
    id: 84,
    name: 'City Information Office',
    code: 'CIO',
    description: 'Public information and communication',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'cio@digoscity.gov.ph', phone: '(082) 553-1249' },
    response_time_hours: 24,
    escalation_time_hours: 48
  },
  {
    id: 85,
    name: "City Accountant's Office",
    code: 'CAO',
    description: 'Financial review and accounting services',
    is_active: true,
    created_at: '2025-10-22T13:12:20.807575+00:00',
    updated_at: '2025-10-22T13:12:20.807575+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: { email: 'cao@digoscity.gov.ph', phone: '(082) 553-1250' },
    response_time_hours: 48,
    escalation_time_hours: 96
  },
  {
    id: 86,
    name: 'Department of Education – Digos City Division',
    code: 'DEPED',
    description: 'Educational services and support',
    is_active: true,
    created_at: '2025-10-25T00:32:38.98679+00:00',
    updated_at: '2025-10-25T00:32:38.98679+00:00',
    subcategory_id: null,
    level: 'NGA',
    contact_info: '{"email":"deped.digos@deped.gov.ph","phone":"(082) 553-1251"}',
    response_time_hours: 48,
    escalation_time_hours: 96
  },
  {
    id: 87,
    name: 'DENR – CENRO Digos',
    code: 'DENR',
    description: 'Environmental regulation and compliance',
    is_active: true,
    created_at: '2025-10-25T00:32:39.336634+00:00',
    updated_at: '2025-10-25T00:32:39.336634+00:00',
    subcategory_id: null,
    level: 'NGA',
    contact_info: '{"email":"cenro.digos@denr.gov.ph","phone":"(082) 553-1252"}',
    response_time_hours: 48,
    escalation_time_hours: 96
  },
  {
    id: 88,
    name: 'Department of Trade and Industry – Digos',
    code: 'DTI',
    description: 'Business regulation and trade services',
    is_active: true,
    created_at: '2025-10-25T00:32:39.498284+00:00',
    updated_at: '2025-10-25T00:32:39.498284+00:00',
    subcategory_id: null,
    level: 'NGA',
    contact_info: '{"email":"dti.digos@dti.gov.ph","phone":"(082) 553-1253"}',
    response_time_hours: 24,
    escalation_time_hours: 48
  },
  {
    id: 89,
    name: 'Land Transportation Office – Digos',
    code: 'LTO',
    description: 'Vehicle registration and transport licensing',
    is_active: true,
    created_at: '2025-10-25T00:32:39.621345+00:00',
    updated_at: '2025-10-25T00:32:39.621345+00:00',
    subcategory_id: null,
    level: 'NGA',
    contact_info: '{"email":"lto.digos@lto.gov.ph","phone":"(082) 553-1254"}',
    response_time_hours: 12,
    escalation_time_hours: 24
  },
  {
    id: 90,
    name: 'Department of Labor and Employment – Digos',
    code: 'DOLE',
    description: 'Labor regulation and employment services',
    is_active: true,
    created_at: '2025-10-25T00:32:39.754543+00:00',
    updated_at: '2025-10-25T00:32:39.754543+00:00',
    subcategory_id: null,
    level: 'NGA',
    contact_info: '{"email":"dole.digos@dole.gov.ph","phone":"(082) 553-1255"}',
    response_time_hours: 24,
    escalation_time_hours: 48
  },
  {
    id: 95,
    name: 'Engineering',
    code: 'ENG',
    description: 'Engineering Department',
    is_active: true,
    created_at: '2025-11-28T14:41:02.614034+00:00',
    updated_at: '2025-11-28T14:41:02.614034+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: {},
    response_time_hours: 24,
    escalation_time_hours: 72
  },
  {
    id: 96,
    name: 'Health',
    code: 'HLT',
    description: 'Health Department',
    is_active: true,
    created_at: '2025-11-28T14:41:02.953898+00:00',
    updated_at: '2025-11-28T14:41:02.953898+00:00',
    subcategory_id: null,
    level: 'LGU',
    contact_info: {},
    response_time_hours: 24,
    escalation_time_hours: 72
  }
]
--- Ensuring Departments Exist ---
[SETUP] Department ENG already exists.
[SETUP] Department HLT already exists.
--- Testing validateDepartmentCodes ---
[DB] Initializing Supabase client. Service Role Key present: true
[TEST] validateDepartmentCodes result: { validCodes: [ 'ENG', 'HLT' ], invalidCodes: [] }
--- Ensuring Test Users Exist ---
[SETUP] User citizen_test@example.com already exists. Updating...
[SETUP] User coordinator@example.com already exists. Updating...
[SETUP] User admin_eng@example.com already exists. Updating...
[SETUP] User officer_eng1@example.com already exists. Updating...
[SETUP] User officer_eng2@example.com already exists. Updating...
[SETUP] User admin_hlt@example.com already exists. Updating...
[SETUP] User officer_hlt1@example.com already exists. Updating...
--- Logging in Users ---
[AUTH] Logging in citizen (citizen_test@example.com)...
[AUTH] ✅ citizen logged in.
[AUTH] Logging in coordinator (coordinator@example.com)...
[AUTH] ✅ coordinator logged in.
[AUTH] Logging in adminA (admin_eng@example.com)...
[AUTH] ✅ adminA logged in.
[AUTH] Logging in officerA1 (officer_eng1@example.com)...
[AUTH] ✅ officerA1 logged in.
[AUTH] Logging in officerA2 (officer_eng2@example.com)...
[AUTH] ✅ officerA2 logged in.
[AUTH] Logging in adminB (admin_hlt@example.com)...
[AUTH] ✅ adminB logged in.
[AUTH] Logging in officerB1 (officer_hlt1@example.com)...
[AUTH] ✅ officerB1 logged in.

=== SCENARIO 1: Single Dept, Single Officer ===
[CITIZEN] Submitting complaint...
[CITIZEN] ✅ Complaint submitted: 8524323c-19a4-43a1-90a7-cfec9993ecb9
[COORDINATOR] Assigning complaint 8524323c-19a4-43a1-90a7-cfec9993ecb9 to ENG...
[COORDINATOR] ✅ Assignment successful.
[LGU_ADMIN] Assigning complaint 8524323c-19a4-43a1-90a7-cfec9993ecb9 to officers: 4698c616-daf4-48ff-acad-424ef982e573...
[LGU_ADMIN] ✅ Assignment successful.
[OFFICE] Resolving complaint 8524323c-19a4-43a1-90a7-cfec9993ecb9...
[OFFICE] ✅ Resolution successful.
[CITIZEN] Confirming resolution for 8524323c-19a4-43a1-90a7-cfec9993ecb9...
[CITIZEN] ✅ Confirmation successful.

=== SCENARIO 2: Multi Dept, Single Officer per Dept ===
[CITIZEN] Submitting complaint...
[CITIZEN] ✅ Complaint submitted: 817a8227-342f-4da0-acc0-54c805c0d1d6
[COORDINATOR] Assigning complaint 817a8227-342f-4da0-acc0-54c805c0d1d6 to ENG, HLT...
[COORDINATOR] ✅ Assignment successful.
[LGU_ADMIN] Assigning complaint 817a8227-342f-4da0-acc0-54c805c0d1d6 to officers: 4698c616-daf4-48ff-acad-424ef982e573...
[LGU_ADMIN] ✅ Assignment successful.
[LGU_ADMIN] Assigning complaint 817a8227-342f-4da0-acc0-54c805c0d1d6 to officers: cfbd32f8-fbb0-43c0-bc35-a8cfceb1a355...
[LGU_ADMIN] ✅ Assignment successful.
[OFFICE] Resolving complaint 817a8227-342f-4da0-acc0-54c805c0d1d6...
[OFFICE] ✅ Resolution successful.
[OFFICE] Resolving complaint 817a8227-342f-4da0-acc0-54c805c0d1d6...
[OFFICE] ✅ Resolution successful.
[CITIZEN] Confirming resolution for 817a8227-342f-4da0-acc0-54c805c0d1d6...
[CITIZEN] ✅ Confirmation successful.

=== SCENARIO 3: Single Dept, Multi Officers ===
[CITIZEN] Submitting complaint...
[CITIZEN] ✅ Complaint submitted: 1e985e52-8609-4062-9f88-6e1e69f7da09
[COORDINATOR] Assigning complaint 1e985e52-8609-4062-9f88-6e1e69f7da09 to ENG...
[COORDINATOR] ✅ Assignment successful.
[LGU_ADMIN] Assigning complaint 1e985e52-8609-4062-9f88-6e1e69f7da09 to officers: 4698c616-daf4-48ff-acad-424ef982e573, ef7e9256-13fb-4c6d-a57b-9f25af5aa87e...
[LGU_ADMIN] ✅ Assignment successful.
[OFFICE] Resolving complaint 1e985e52-8609-4062-9f88-6e1e69f7da09...
[OFFICE] ✅ Resolution successful.
[OFFICE] Resolving complaint 1e985e52-8609-4062-9f88-6e1e69f7da09...
[OFFICE] ✅ Resolution successful.
[CITIZEN] Confirming resolution for 1e985e52-8609-4062-9f88-6e1e69f7da09...
[CITIZEN] ✅ Confirmation successful.
