<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CitizenLink - Complaint Analytics | Digos City</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/toast.css" />
    <link rel="stylesheet" href="/css/components/sidebar.css" />
    <link rel="stylesheet" href="/css/app.css" />
    <link rel="stylesheet" href="/css/components/clock.css" />
    <link rel="stylesheet" href="/css/header-redesign.css" />
    <link rel="stylesheet" href="/css/viewport-fix.css" />
    <link rel="stylesheet" href="/brain-analytics/analytics.css">
</head>
<body>
    <div id="dashboard-clock" class="dashboard-clock" aria-live="polite"></div>
    <div class="app-container">
        <div class="header-container"></div>
        <div id="sidebar" class="collapsible"></div>
        <div id="app" class="collapsible">
            <!-- Tab Navigation -->
            <nav class="analytics-tabs">
                <button class="nav-tab active" data-tab="overview">
                    <i class="fas fa-tachometer-alt"></i> <span>Overview</span>
                </button>
                <button class="nav-tab" data-tab="temporal">
                    <i class="fas fa-clock"></i> <span>Time Trends</span>
                </button>
                <button class="nav-tab" data-tab="categories">
                    <i class="fas fa-tags"></i> <span>Categories</span>
                </button>
                <button class="nav-tab" data-tab="edge-cases">
                    <i class="fas fa-exclamation-triangle"></i> <span>Smart Detection</span>
                </button>
                <button class="nav-tab" data-tab="data-table">
                    <i class="fas fa-table"></i> <span>All Complaints</span>
                </button>
                <button class="nav-tab" data-tab="system-training">
                    <i class="fas fa-brain"></i> <span>Train System</span>
                </button>
            </nav>

            <div id="loadingOverlay" class="loading-overlay">
                <div class="loading-content">
                    <div class="spinner"></div>
                    <p>Loading Complaints...</p>
                    <p class="loading-detail">Processing data, please wait...</p>
                </div>
            </div>

            <main class="main-content">
        <section id="overview" class="tab-content active">
            <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
            <p class="section-description">Summary of all citizen complaints processed by the CitizenLink system.</p>
            <div class="metric-cards">
                <div class="metric-card">
                    <div class="metric-icon"><i class="fas fa-clipboard-list"></i></div>
                    <div class="metric-value" id="totalComplaints">-</div>
                    <div class="metric-label">Total Complaints</div>
                </div>
                <div class="metric-card danger">
                    <div class="metric-icon"><i class="fas fa-exclamation-circle"></i></div>
                    <div class="metric-value" id="tier1Count">-</div>
                    <div class="metric-label">High Priority</div>
                </div>
                <div class="metric-card warning">
                    <div class="metric-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="metric-value" id="tier2Count">-</div>
                    <div class="metric-label">Medium Priority</div>
                </div>
                <div class="metric-card success">
                    <div class="metric-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="metric-value" id="tier3Count">-</div>
                    <div class="metric-label">Low Priority</div>
                </div>
                <div class="metric-card danger">
                    <div class="metric-icon"><i class="fas fa-fire"></i></div>
                    <div class="metric-value" id="criticalCount">-</div>
                    <div class="metric-label">Emergency Cases</div>
                </div>
                <div class="metric-card info">
                    <div class="metric-icon"><i class="fas fa-key"></i></div>
                    <div class="metric-value" id="keywordsDetected">-</div>
                    <div class="metric-label">Keywords Found</div>
                </div>
                <div class="metric-card accent">
                    <div class="metric-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="metric-value" id="avgTriageScore">-</div>
                    <div class="metric-label">Avg. Priority Score</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon"><i class="fas fa-hashtag"></i></div>
                    <div class="metric-value" id="uniqueKeywords">-</div>
                    <div class="metric-label">Unique Keywords</div>
                </div>
            </div>

            <div class="command-center-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="command-widget" style="background: var(--card-bg, white); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; border-left: 4px solid var(--danger);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-bell" style="color: var(--danger); font-size: 1.2em;"></i>
                        <h4 style="margin: 0; font-size: 1em; color: var(--gray-800);">Recent High-Priority Alerts</h4>
                        <span class="pulse-dot" style="width: 8px; height: 8px; background: var(--danger); border-radius: 50%; animation: pulse 2s infinite;"></span>
                    </div>
                    <div id="recentAlertsTicker" style="max-height: 180px; overflow-y: auto;">
                        <div style="padding: 10px; color: var(--gray-500); text-align: center;">
                            <i class="fas fa-spinner fa-spin"></i> Loading alerts...
                        </div>
                    </div>
                </div>
                <div class="command-widget" style="background: var(--card-bg, white); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; border-left: 4px solid var(--primary);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-chart-pie" style="color: var(--primary); font-size: 1.2em;"></i>
                        <h4 style="margin: 0; font-size: 1em; color: var(--gray-800);">Category Breakdown</h4>
                    </div>
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <canvas id="overviewCategoryPie" style="max-width: 120px; max-height: 120px;"></canvas>
                        <div id="categoryLegend" style="flex: 1; font-size: 0.85em;">
                            <div style="padding: 10px; color: var(--gray-500); text-align: center;">Loading...</div>
                        </div>
                    </div>
                </div>
                <div class="command-widget" style="background: var(--card-bg, white); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; border-left: 4px solid var(--success);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-heartbeat" style="color: var(--success); font-size: 1.2em;"></i>
                        <h4 style="margin: 0; font-size: 1em; color: var(--gray-800);">System Health</h4>
                    </div>
                    <div id="systemHealthStatus" style="display: flex; flex-direction: column; gap: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: var(--gray-100); border-radius: 6px;">
                            <span><i class="fas fa-brain" style="margin-right: 8px; color: var(--primary);"></i> NLP Engine</span>
                            <span class="status-badge" style="background: var(--success); color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8em;">‚óè Online</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: var(--gray-100); border-radius: 6px;">
                            <span><i class="fas fa-hourglass-half" style="margin-right: 8px; color: var(--warning);"></i> Pending Reviews</span>
                            <span id="healthPendingCount" style="font-weight: bold; color: var(--warning);">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: var(--gray-100); border-radius: 6px;">
                            <span><i class="fas fa-database" style="margin-right: 8px; color: var(--info);"></i> Database</span>
                            <span class="status-badge" style="background: var(--success); color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8em;">‚óè OK</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: var(--gray-100); border-radius: 6px;">
                            <span><i class="fas fa-book" style="margin-right: 8px; color: var(--accent);"></i> Dictionary</span>
                            <span id="healthDictSize" style="font-weight: bold; color: var(--accent);">- entries</span>
                        </div>
                    </div>
                </div>
                <div class="command-widget" style="background: var(--card-bg, white); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; border-left: 4px solid var(--warning);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-map-marked-alt" style="color: var(--warning); font-size: 1.2em;"></i>
                        <h4 style="margin: 0; font-size: 1em; color: var(--gray-800);">Top 5 Active Barangays</h4>
                    </div>
                    <div id="topBarangaysList" style="display: flex; flex-direction: column; gap: 8px;">
                        <div style="padding: 10px; color: var(--gray-500); text-align: center;">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                    </div>
                </div>
                <div class="command-widget" style="background: var(--card-bg, white); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; border-left: 4px solid var(--info);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-stopwatch" style="color: var(--info); font-size: 1.2em;"></i>
                        <h4 style="margin: 0; font-size: 1em; color: var(--gray-800);">Response Metrics</h4>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, var(--info-light), var(--info)); border-radius: 8px; color: white;">
                            <div style="font-size: 2em; font-weight: bold;" id="avgResponseTime">--</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">Avg. Processing Time</div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <div style="flex: 1; text-align: center; padding: 10px; background: var(--gray-100); border-radius: 6px;">
                                <div style="font-size: 1.2em; font-weight: bold; color: var(--success);" id="resolvedToday">0</div>
                                <div style="font-size: 0.75em; color: var(--gray-600);">Resolved Today</div>
                            </div>
                            <div style="flex: 1; text-align: center; padding: 10px; background: var(--gray-100); border-radius: 6px;">
                                <div style="font-size: 1.2em; font-weight: bold; color: var(--primary);" id="processedTotal">0</div>
                                <div style="font-size: 0.75em; color: var(--gray-600);">Total Processed</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-row">
                <div class="chart-container half">
                    <h3><i class="fas fa-chart-pie"></i> Priority Distribution</h3>
                    <canvas id="tierDistChart"></canvas>
                </div>
                <div class="chart-container half">
                    <h3><i class="fas fa-chart-bar"></i> Complaints by Category</h3>
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

            <div class="chart-row">
                <div class="chart-container half">
                    <h3><i class="fas fa-map-marked-alt"></i> Complaints by Barangay</h3>
                    <canvas id="barangayChart"></canvas>
                </div>
                <div class="chart-container half">
                    <h3><i class="fas fa-brain"></i> NLP Intelligence Impact</h3>
                    <canvas id="nlpImpactChart"></canvas>
                </div>
            </div>
        </section>

        <section id="temporal" class="tab-content">
            <h2 class="section-title"><i class="fas fa-clock"></i> Time Trend Analysis</h2>
            <p class="section-description">Analyze complaint patterns over time to identify peak periods and seasonal trends.</p>
            
            <!-- Time Summary Cards -->
            <div class="metric-cards" style="margin-bottom: 20px;">
                <div class="metric-card info">
                    <div class="metric-icon"><i class="fas fa-calendar-day"></i></div>
                    <div class="metric-value" id="todayCount">-</div>
                    <div class="metric-label">Today's Complaints</div>
                </div>
                <div class="metric-card warning">
                    <div class="metric-icon"><i class="fas fa-calendar-week"></i></div>
                    <div class="metric-value" id="weekCount">-</div>
                    <div class="metric-label">This Week</div>
                </div>
                <div class="metric-card success">
                    <div class="metric-icon"><i class="fas fa-calendar"></i></div>
                    <div class="metric-value" id="monthCount">-</div>
                    <div class="metric-label">This Month</div>
                </div>
                <div class="metric-card accent">
                    <div class="metric-icon"><i class="fas fa-fire-alt"></i></div>
                    <div class="metric-value" id="peakHour">-</div>
                    <div class="metric-label">Peak Hour</div>
                </div>
            </div>
            
            <div class="chart-row">
                <div class="chart-container full">
                    <h3><i class="fas fa-chart-line"></i> Complaints Over Time (Last 30 Days)</h3>
                    <canvas id="timeTrendChart"></canvas>
                </div>
            </div>
            <div class="chart-row">
                <div class="chart-container half">
                    <h3><i class="fas fa-calendar-alt"></i> Monthly Distribution</h3>
                    <canvas id="monthlyChart"></canvas>
                </div>
                <div class="chart-container half">
                    <h3><i class="fas fa-clock"></i> Complaints by Hour of Day</h3>
                    <canvas id="hourlyChart"></canvas>
                </div>
            </div>
            <div class="chart-row">
                <div class="chart-container half">
                    <h3><i class="fas fa-calendar-week"></i> Day of Week Pattern</h3>
                    <canvas id="dayOfWeekChart"></canvas>
                </div>
                <div class="chart-container half">
                    <h3><i class="fas fa-chart-area"></i> Priority Trend Over Time</h3>
                    <canvas id="priorityTrendChart"></canvas>
                </div>
            </div>
        </section>

        <section id="categories" class="tab-content">
            <h2 class="section-title"><i class="fas fa-tags"></i> Category Intelligence</h2>
            <p class="section-description">Deep dive into complaint categories, priority levels, and keyword analysis powered by NLP.</p>
            
            <!-- Category Summary Cards -->
            <div class="metric-cards" style="margin-bottom: 20px;">
                <div class="metric-card">
                    <div class="metric-icon"><i class="fas fa-folder-open"></i></div>
                    <div class="metric-value" id="uniqueCategoryCount">-</div>
                    <div class="metric-label">Active Categories</div>
                </div>
                <div class="metric-card danger">
                    <div class="metric-icon"><i class="fas fa-arrow-up"></i></div>
                    <div class="metric-value" id="topCategoryName">-</div>
                    <div class="metric-label">Top Category</div>
                </div>
                <div class="metric-card info">
                    <div class="metric-icon"><i class="fas fa-robot"></i></div>
                    <div class="metric-value" id="nlpAccuracy">-</div>
                    <div class="metric-label">NLP Confidence</div>
                </div>
                <div class="metric-card warning">
                    <div class="metric-icon"><i class="fas fa-sync-alt"></i></div>
                    <div class="metric-value" id="reclassifiedCount">-</div>
                    <div class="metric-label">AI Reclassified</div>
                </div>
            </div>
            
            <div class="chart-row">
                <div class="chart-container half">
                    <h3><i class="fas fa-chart-pie"></i> Category Distribution</h3>
                    <canvas id="categoryDistChart"></canvas>
                </div>
                <div class="chart-container half">
                    <h3><i class="fas fa-layer-group"></i> Priority by Category</h3>
                    <canvas id="categoryPriorityChart"></canvas>
                </div>
            </div>
            <div class="chart-row">
                <div class="chart-container full">
                    <h3><i class="fas fa-key"></i> Top Keywords Detected by NLP</h3>
                    <div id="keywordCloud" class="keyword-cloud" style="padding: 20px; min-height: 120px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; justify-content: center;"></div>
                </div>
            </div>
            <div class="chart-row">
                <div class="chart-container half">
                    <h3><i class="fas fa-chart-bar"></i> Subcategory Breakdown</h3>
                    <canvas id="subcategoryChart"></canvas>
                </div>
                <div class="chart-container half">
                    <h3><i class="fas fa-brain"></i> NLP Detection Methods</h3>
                    <canvas id="nlpMethodChart"></canvas>
                </div>
            </div>
        </section>

        <section id="edge-cases" class="tab-content">
            <h2 class="section-title"><i class="fas fa-exclamation-triangle"></i> Smart Detection Analysis</h2>
            <p class="section-description">Review edge cases where NLP detected figurative language, conditional statements, or category mismatches that need human review.</p>
            
            <!-- Smart Detection Summary -->
            <div class="metric-cards" style="margin-bottom: 20px;">
                <div class="metric-card info">
                    <div class="metric-icon"><i class="fas fa-theater-masks"></i></div>
                    <div class="metric-value" id="totalMetaphors">0</div>
                    <div class="metric-label">Figurative Detected</div>
                </div>
                <div class="metric-card warning">
                    <div class="metric-icon"><i class="fas fa-question-circle"></i></div>
                    <div class="metric-value" id="totalSpeculation">0</div>
                    <div class="metric-label">Conditional Reports</div>
                </div>
                <div class="metric-card danger">
                    <div class="metric-icon"><i class="fas fa-not-equal"></i></div>
                    <div class="metric-value" id="totalMismatch">0</div>
                    <div class="metric-label">Mismatches Found</div>
                </div>
                <div class="metric-card success">
                    <div class="metric-icon"><i class="fas fa-percentage"></i></div>
                    <div class="metric-value" id="edgeCaseRate">0%</div>
                    <div class="metric-label">Edge Case Rate</div>
                </div>
            </div>
            
            <div class="edge-case-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                <div class="edge-case-card" style="background: var(--card-bg, #fff); border-left: 4px solid #7B1FA2;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;"><i class="fas fa-theater-masks" style="color: #7B1FA2;"></i> Figurative Language</h3>
                        <span class="badge" style="background: #E1BEE7; color: #7B1FA2; font-size: 16px; padding: 4px 12px;" id="metaphorCount">0</span>
                    </div>
                    <p style="margin: 0 0 12px; font-size: 12px; color: var(--gray-600);">Metaphors, similes, and figurative expressions detected</p>
                    <div class="edge-case-list" id="metaphorList" style="max-height: 280px; overflow-y: auto;"></div>
                </div>
                <div class="edge-case-card" style="background: var(--card-bg, #fff); border-left: 4px solid #E65100;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;"><i class="fas fa-question-circle" style="color: #E65100;"></i> Conditional Reports</h3>
                        <span class="badge" style="background: #FFE0B2; color: #E65100; font-size: 16px; padding: 4px 12px;" id="speculationCount">0</span>
                    </div>
                    <p style="margin: 0 0 12px; font-size: 12px; color: var(--gray-600);">Speculative or future-tense statements requiring verification</p>
                    <div class="edge-case-list" id="speculationList" style="max-height: 280px; overflow-y: auto;"></div>
                </div>
                <div class="edge-case-card" style="background: var(--card-bg, #fff); border-left: 4px solid #C62828;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;"><i class="fas fa-not-equal" style="color: #C62828;"></i> Category Mismatches</h3>
                        <span class="badge" style="background: #FFCDD2; color: #C62828; font-size: 16px; padding: 4px 12px;" id="mismatchCount">0</span>
                    </div>
                    <p style="margin: 0 0 12px; font-size: 12px; color: var(--gray-600);">AI detected different category than user selected</p>
                    <div class="edge-case-list" id="mismatchList" style="max-height: 280px; overflow-y: auto;"></div>
                </div>
                <div class="edge-case-card" style="background: var(--card-bg, #fff); border-left: 4px solid var(--danger);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;"><i class="fas fa-exclamation-circle" style="color: var(--danger);"></i> Critical Alerts</h3>
                        <span class="badge" style="background: var(--danger-light); color: var(--danger); font-size: 16px; padding: 4px 12px;" id="alertCount">0</span>
                    </div>
                    <p style="margin: 0 0 12px; font-size: 12px; color: var(--gray-600);">High-priority emergencies requiring immediate attention</p>
                    <div class="edge-case-list" id="alertList" style="max-height: 280px; overflow-y: auto;"></div>
                </div>
            </div>
        </section>

        <section id="data-table" class="tab-content">
            <div class="section-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                <div>
                    <h2 class="section-title" style="margin-bottom: 4px;"><i class="fas fa-table"></i> Complete Dataset</h2>
                    <p class="section-description" style="margin: 0;">Search, filter, and examine all complaints in the system.</p>
                </div>
                <button id="exportCSV" class="btn btn-primary" title="Export to Excel" style="padding: 10px 16px; border-radius: 8px; background: var(--primary); color: white; border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: 600;">
                    <i class="fas fa-file-excel"></i> Export Excel
                </button>
            </div>
            <div class="table-controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search complaints...">
                </div>
                <div class="filters">
                    <select id="tierFilter">
                        <option value="all">All Priorities</option>
                        <option value="1">High Priority (Tier 1)</option>
                        <option value="2">Medium Priority (Tier 2)</option>
                        <option value="3">Low Priority (Tier 3)</option>
                    </select>
                    <select id="categoryFilter">
                        <option value="all">All Categories</option>
                    </select>
                    <select id="filterType">
                        <option value="all">All Types</option>
                        <option value="critical">Emergency Only</option>
                        <option value="metaphor">Figurative Language</option>
                        <option value="speculation">Conditional Reports</option>
                        <option value="mismatch">Category Mismatch</option>
                    </select>
                </div>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-sort="id">ID <i class="fas fa-sort"></i></th>
                            <th data-sort="category">Category <i class="fas fa-sort"></i></th>
                            <th data-sort="barangay">Barangay <i class="fas fa-sort"></i></th>
                            <th data-sort="triage_score">Priority <i class="fas fa-sort"></i></th>
                            <th>Description</th>
                            <th>Flags</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <div class="pagination">
                <button id="prevPage"><i class="fas fa-chevron-left"></i> Prev</button>
                <span id="pageInfo">Page 1</span>
                <button id="nextPage">Next <i class="fas fa-chevron-right"></i></button>
                <select id="itemsPerPage">
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
        </section>

        <section id="system-training" class="tab-content">
            <h2 class="section-title"><i class="fas fa-brain"></i> Train the System</h2>
            <p class="section-description">Help improve the system by reviewing complaints it wasn't sure about. Your corrections teach it to be more accurate.</p>
            
            <!-- Training Stats Summary -->
            <div class="metric-cards" style="margin-bottom: 20px;">
                <div class="metric-card warning">
                    <div class="metric-icon"><i class="fas fa-hourglass-half"></i></div>
                    <div class="metric-value" id="pendingTrainCount">0</div>
                    <div class="metric-label">Pending Review</div>
                </div>
                <div class="metric-card success">
                    <div class="metric-icon"><i class="fas fa-check-double"></i></div>
                    <div class="metric-value" id="trainedTodayCount">0</div>
                    <div class="metric-label">Trained Today</div>
                </div>
                <div class="metric-card info">
                    <div class="metric-icon"><i class="fas fa-percentage"></i></div>
                    <div class="metric-value" id="avgConfidenceScore">-</div>
                    <div class="metric-label">Avg Confidence</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="metric-value" id="modelAccuracy">-</div>
                    <div class="metric-label">Model Accuracy</div>
                </div>
            </div>
            
            <div class="train-system-layout">
                <!-- Left Panel: List of Items to Train -->
                <div class="train-card">
                    <div class="train-card-header">
                        <h3><i class="fas fa-list-ul"></i> Pending Review Queue</h3>
                        <div style="display:flex; gap:8px;">
                            <button id="refreshPendingBtn" class="btn btn-sm btn-secondary" title="Refresh list">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button id="fetchLowConfidenceBtn" class="btn btn-sm btn-primary">
                                <i class="fas fa-download"></i> Fetch Items
                            </button>
                        </div>
                    </div>
                    <div class="train-list" id="trainingList">
                        <div style="padding: 40px; text-align: center; color: var(--gray-500);">
                            <i class="fas fa-inbox" style="font-size: 32px; margin-bottom: 12px; display: block; opacity: 0.5;"></i>
                            <p>Click "Fetch Items" to load low-confidence complaints.</p>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Training Form -->
                <div class="train-card">
                    <div class="train-card-header">
                        <h3><i class="fas fa-edit"></i> Training Console</h3>
                        <span id="trainingStatusBadge" class="badge badge-noise">No Item Selected</span>
                    </div>
                    <div class="train-form" id="trainingForm">
                        <div class="ai-prediction-box">
                            <div class="prediction-row">
                                <span><strong>System Guess:</strong> <span id="lblSystemGuess">-</span></span>
                                <span>Confidence: <strong id="lblConfidence">-</strong></span>
                            </div>
                            <div class="confidence-bar-bg">
                                <div class="confidence-bar-fill" id="barConfidence"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Original Complaint Text</label>
                            <div id="lblOriginalText" style="padding: 12px; background: var(--gray-100); border-radius: 8px; font-size: 14px; color: var(--gray-800); min-height: 60px; border: 1px solid var(--gray-300);">Select an item from the left to view details.</div>
                        </div>

                        <div class="form-group">
                            <label for="inputTrainKeyword">Identify Key Term (Entity/Issue)</label>
                            <input type="text" id="inputTrainKeyword" placeholder="e.g., 'lubak', 'baha', 'walay tubig'" disabled>
                            <small style="color: var(--gray-500); font-size: 11px;">Extract the specific word that defines the category.</small>
                        </div>

                        <div class="form-group">
                            <label for="selectTrainCategory">Correct Category</label>
                            <select id="selectTrainCategory" disabled>
                                <option value="">-- Select Category --</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="selectTrainSubcategory">Subcategory (Optional)</label>
                            <select id="selectTrainSubcategory" disabled>
                                <option value="">-- Select Subcategory --</option>
                            </select>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: auto;">
                            <button id="btnSkipTrain" class="btn btn-secondary" style="flex: 1;" disabled>Skip</button>
                            <button id="btnSaveTrain" class="btn btn-primary" style="flex: 2;" disabled>
                                <i class="fas fa-check"></i> Save & Update
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
            </main>

            <div id="complaintModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-clipboard-list"></i> Complaint Details</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body" id="modalBody"></div>
                </div>
            </div>

            <div id="presentationOverlay" class="presentation-overlay">
                <div class="presentation-controls">
                    <button id="prevSlide"><i class="fas fa-chevron-left"></i> Previous</button>
                    <span id="slideIndicator">1 / 7</span>
                    <button id="nextSlide">Next <i class="fas fa-chevron-right"></i></button>
                    <button id="exitPresentation"><i class="fas fa-times"></i> Exit</button>
                </div>
                <div class="presentation-content" id="presentationContent"></div>
            </div>
        </div><!-- end #app -->
    </div><!-- end .app-container -->

    <!-- Core Scripts -->
    <script type="module" src="/js/lib/supabase-boot.js"></script>
    <script type="module" src="/js/auth/authChecker.js"></script>
    <script type="module" src="/js/auth/roleToggle.js"></script>
    <script type="module" src="/js/components/toast.js"></script>
    <script type="module" src="/js/components/header.js"></script>
    <script type="module" src="/js/components/sidebar.js"></script>
    <script type="module" src="/js/components/clock.js"></script>
    
    <!-- Brain Analytics Scripts -->
    <script src="/brain-dashboard/shared/taxonomy.js"></script>
    <script src="/brain-dashboard/nlp-processor.js"></script>
    <script src="/brain-dashboard/causality-manager.js"></script>
    <script src="/brain-dashboard/simulation-engine.js"></script>
    <script src="/brain-analytics/analytics.js"></script>
    <script type="module" src="/brain-analytics/train-system.js"></script>
</body>
</html>
