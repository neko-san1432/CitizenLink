<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />
    <title>Coordinator Dashboard - CitizenLink</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/toast.css" />
    <link rel="stylesheet" href="/css/components/clock.css" />
    <link rel="stylesheet" href="/css/components/sidebar.css" />
    <link rel="stylesheet" href="/css/app.css" />
    <link rel="stylesheet" href="/css/header-redesign.css" />
    <link rel="stylesheet" href="/css/pages/dashboard-common.css" />
    <link rel="stylesheet" href="/css/pages/coordinator-dashboard.css" />
    <link rel="stylesheet" href="/css/viewport-fix.css" />
  </head>
  <body>
    <div id="dashboard-clock" class="dashboard-clock" aria-live="polite"></div>
    <div class="app-container">
      <div class="header-container"></div>
      <div id="sidebar" class="collapsible"></div>

      <div id="app" class="collapsible coordinator-dashboard">
        <!-- Standard Dashboard Header -->
        <div class="dashboard-header">
          <div class="dashboard-title-group">
            <h1>üìã Complaint Coordinator Dashboard</h1>
            <p class="dashboard-subtitle">
              Intelligent complaint review and management system
            </p>
          </div>
          <div class="header-quick-actions">
            <a
              class="quick-action-btn quick-action-btn--sm"
              href="/review-queue"
            >
              <div class="quick-action-icon">üìã</div>
              <div class="quick-action-text">Review</div>
            </a>
            <a class="quick-action-btn quick-action-btn--sm" href="/heatmap">
              <div class="quick-action-icon">üó∫Ô∏è</div>
              <div class="quick-action-text">Heatmap</div>
            </a>
            <a class="quick-action-btn quick-action-btn--sm" href="/myProfile">
              <div class="quick-action-icon">üë§</div>
              <div class="quick-action-text">Profile</div>
            </a>
            <a
              class="quick-action-btn quick-action-btn--sm"
              href="/departments"
            >
              <div class="quick-action-icon">üè¢</div>
              <div class="quick-action-text">Depts</div>
            </a>
          </div>
        </div>

        <!-- Statistics Grid -->
        <div class="stats-grid" id="stats-grid">
          <div class="stat-card urgent">
            <div class="stat-icon">‚è∞</div>
            <div class="stat-content">
              <div class="stat-label">Pending Reviews</div>
              <div class="stat-value" id="stat-pending">-</div>
              <div class="stat-trend" id="pending-trend"></div>
            </div>
          </div>
          <div class="stat-card warning">
            <div class="stat-icon">üìä</div>
            <div class="stat-content">
              <div class="stat-label">Reviews (7 days)</div>
              <div class="stat-value" id="stat-reviews">-</div>
              <div class="stat-trend" id="reviews-trend"></div>
            </div>
          </div>
          <div class="stat-card success">
            <div class="stat-icon">üîó</div>
            <div class="stat-content">
              <div class="stat-label">Duplicates Merged</div>
              <div class="stat-value" id="stat-duplicates">-</div>
              <div class="stat-trend" id="duplicates-trend"></div>
            </div>
          </div>
          <div class="stat-card info">
            <div class="stat-icon">üì§</div>
            <div class="stat-content">
              <div class="stat-label">Assignments Made</div>
              <div class="stat-value" id="stat-assignments">-</div>
              <div class="stat-trend" id="assignments-trend"></div>
            </div>
          </div>
        </div>

        <!-- Main Content Grid -->
        <div class="dashboard-grid">
          <!-- Review Queue Section -->
          <div class="dashboard-section">
            <div class="section-header">
              <h2 class="section-title">üìã Review Queue</h2>
              <div class="section-controls">
                <select id="queue-filter" class="filter-select">
                  <option value="all">All Complaints</option>
                  <option value="urgent">Urgent Only</option>
                  <option value="high">High Priority</option>
                  <option value="duplicates">Potential Duplicates</option>
                </select>
                <button class="btn btn-primary" id="view-full-queue-btn">
                  View Full Queue
                </button>
              </div>
            </div>
            <div id="review-queue-container" class="content-container">
              <div class="loading">
                <div class="spinner"></div>
                <p>Loading review queue...</p>
              </div>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="dashboard-section">
            <div class="section-header">
              <h2 class="section-title">üïí Recent Activity</h2>
              <div class="section-controls">
                <button class="btn btn-secondary" id="refresh-activity-btn">
                  Refresh
                </button>
              </div>
            </div>
            <div id="activity-container" class="content-container">
              <div class="activity-list">
                <div class="loading">
                  <div class="spinner"></div>
                  <p>Loading recent activity...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="toast-container" class="toast-container"></div>
    <script type="module" src="../../js/components/toast.js"></script>
    <script
      type="module"
      src="../../js/services/toastNotificationService.js"
    ></script>

    <script type="module" src="../../js/components/header.js"></script>
    <script type="module" src="../../js/components/sidebar.js"></script>
    <script type="module" src="../../js/auth/authChecker.js"></script>
    <script type="module" src="../../js/auth/roleToggle.js"></script>
    <script type="module" src="../../js/components/clock.js"></script>
    <script type="module" src="../../js/coordinator/dashboard.js"></script>

    <script type="module">
      // Initialize toast notification service
      import toastNotificationService from "../../js/services/toastNotificationService.js";

      // Start listening for real-time notifications
      toastNotificationService.startListening();

      // Clean up on page unload
      window.addEventListener("beforeunload", () => {
        toastNotificationService.stopListening();
      });
    </script>
    <!-- Quick Classification & Assignment Modal -->
    <div id="quick-action-modal" class="modal-overlay hidden">
      <div class="modal-container glass-panel animate-scale-in">
        <div class="modal-header">
          <h3 id="modal-title">Quick Classification & Assignment</h3>
          <button class="close-modal-btn" id="close-modal-btn">&times;</button>
        </div>
        <div class="modal-body">
          <form id="quick-action-form">
            <input type="hidden" id="modal-complaint-id" />

            <div
              class="form-group mb-4 p-3 bg-blue-50 rounded border border-blue-200"
            >
              <label class="form-label text-blue-800 font-bold mb-1"
                >Citizen Reported Urgency</label
              >
              <div
                id="modal-citizen-urgency"
                class="text-lg font-bold capitalize"
              >
                -
              </div>
            </div>

            <div class="form-group mb-4">
              <label class="form-label">Classification Verification</label>
              <select id="modal-category" class="form-control" required>
                <option value="">Select Category</option>
                <option value="infrastructure">Infrastructure</option>
                <option value="sanitation">Sanitation</option>
                <option value="security">Security</option>
                <option value="health">Health</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-group mb-4">
              <label class="form-label">Official Urgency Level</label>
              <div class="priority-selector flex gap-2">
                <input
                  type="radio"
                  name="urgency"
                  value="low"
                  id="u-low"
                  class="hidden-radio"
                />
                <label for="u-low" class="priority-btn p-low">Low</label>

                <input
                  type="radio"
                  name="urgency"
                  value="medium"
                  id="u-medium"
                  class="hidden-radio"
                  checked
                />
                <label for="u-medium" class="priority-btn p-medium"
                  >Medium</label
                >

                <input
                  type="radio"
                  name="urgency"
                  value="high"
                  id="u-high"
                  class="hidden-radio"
                />
                <label for="u-high" class="priority-btn p-high">High</label>

                <input
                  type="radio"
                  name="urgency"
                  value="urgent"
                  id="u-urgent"
                  class="hidden-radio"
                />
                <label for="u-urgent" class="priority-btn p-urgent"
                  >Urgent</label
                >
              </div>
            </div>

            <div class="form-group mb-4">
              <label class="form-label">Assign to Department/Officer</label>
              <select id="modal-assignment" class="form-control" required>
                <option value="">Select Department/Officer</option>
                <!-- Dynamically populated -->
              </select>
            </div>

            <div class="form-group mb-4">
              <label class="form-label">Set Deadline</label>
              <input
                type="date"
                id="modal-deadline"
                class="form-control"
                required
              />
            </div>

            <div class="form-group mb-4">
              <label class="form-label">Coordinator Remarks</label>
              <textarea
                id="modal-remarks"
                class="form-control"
                rows="3"
                placeholder="Add your notes here..."
              ></textarea>
            </div>

            <button type="submit" class="btn btn-primary w-full">
              Confirm & Assign
            </button>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>
