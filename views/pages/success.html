<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />
    <title>Success - CitizenLink</title>
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/toast.css" />
    <link rel="stylesheet" href="/css/pages/success.css" />
  </head>
  <body class="success-page">
    <div class="success-container">
      <div class="success-card">
        <div class="success-icon">
          <svg
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="2"
              fill="none"
              stroke-linecap="round"
            />
            <path
              d="M8 12l2 2 4-4"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <h1 class="success-title">Success!</h1>
        <p class="success-message">Your request completed successfully.</p>
        <div
          id="debug-info"
          style="
            background: yellow;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid red;
          "
        >
          <strong>DEBUG INFO:</strong>
          <div id="debug-content">Loading...</div>
        </div>
        <div class="success-actions">
          <a href="/" class="btn btn-secondary">Go Home</a>
          <a href="/dashboard" class="btn btn-primary">Go to Dashboard</a>
        </div>
      </div>
    </div>
    <div id="toast-container" class="toast-container"></div>
    <script type="module" src="/js/components/toast.js"></script>
    <script>
      // IMMEDIATE DIAGNOSTICS - These should ALWAYS run
      (function () {
        try {
          // Update debug div immediately
          const debugDiv = document.getElementById("debug-content");
          if (debugDiv) {
            debugDiv.innerHTML = "Script running! Check console.";
          }

          console.log("========================================");
          console.log("[SUCCESS_HTML] ✅ success.html loaded");
          console.log("[SUCCESS_HTML] URL:", globalThis.location.href);
          console.log("[SUCCESS_HTML] Timestamp:", new Date().toISOString());
          console.log(
            "[SUCCESS_HTML] Document readyState:",
            document.readyState
          );
          console.log("[SUCCESS_HTML] User Agent:", navigator.userAgent);
          console.log("[SUCCESS_HTML] About to load module scripts...");
          console.log("========================================");

          // Update debug div with more info
          if (debugDiv) {
            setTimeout(() => {
              debugDiv.innerHTML = `
            <div>URL: ${globalThis.location.href}</div>
            <div>ReadyState: ${document.readyState}</div>
            <div>Check console for detailed logs</div>
          `;
            }, 100);
          }

          // Also try alert as fallback
          if (globalThis.location.search.includes("debug")) {
            alert("SUCCESS PAGE LOADED - Check console");
          }
        } catch (e) {
          console.error("[SUCCESS_HTML] Error in inline script:", e);
          const debugDiv = document.getElementById("debug-content");
          if (debugDiv) {
            debugDiv.innerHTML = "ERROR: " + e.message;
          }
          alert("ERROR in success.html inline script: " + e.message);
        }
      })();
    </script>
    <script>
      // Check for script load errors BEFORE loading module
      globalThis.addEventListener(
        "error",
        (e) => {
          console.error("[SUCCESS_HTML] Global error caught:", {
            message: e.message,
            filename: e.filename,
            lineno: e.lineno,
            colno: e.colno,
            error: e.error,
          });
          if (e.filename && e.filename.includes("success")) {
            console.error("[SUCCESS_HTML] ❌ Script load error:", e);
            alert("ERROR loading success.js: " + e.message);
          }
        },
        true
      );

      // Check for unhandled promise rejections
      globalThis.addEventListener("unhandledrejection", (e) => {
        console.error("[SUCCESS_HTML] Unhandled promise rejection:", e.reason);
      });

      console.log(
        "[SUCCESS_HTML] Error handlers registered, loading module..."
      );
    </script>
    <script type="module" src="/js/components/success.js"></script>
    <script>
      // Verify module loaded
      setTimeout(() => {
        console.log("[SUCCESS_HTML] Module load check (after 1s):", {
          pathname: globalThis.location.pathname,
          stillOnSuccess: globalThis.location.pathname === "/success",
        });
      }, 1000);
    </script>
  </body>
</html>
