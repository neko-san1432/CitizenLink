<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <title id="profile">Profile</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/toast.css">
    <link rel="stylesheet" href="../css/components/sidebar.css">
    <link rel="stylesheet" href="../css/app.css">
    <link rel="stylesheet" href="../css/components/clock.css">
    <link rel="stylesheet" href="../css/header-redesign.css">
    <link rel="stylesheet" href="../css/viewport-fix.css">
    <style>
      /* Profile page layout - flex column to consume remaining space */
      .profile-page {
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: 0;
        overflow: hidden;
        gap: 1rem;
        padding: 1rem;
        box-sizing: border-box;
      }

      /* Main content area - side by side layout */
      .profile-content-wrapper {
        display: flex;
        flex-direction: row;
        gap: 1.5rem;
        flex: 1;
        min-height: 0;
        overflow: hidden;
      }

      /* Left sidebar - compact profile */
      .profile-sidebar {
        display: flex;
        flex-direction: column;
        gap: 0.625rem;
        width: 280px;
        flex-shrink: 0;
        overflow-y: auto;
        overflow-x: hidden;
        height: 100%;
        align-content: flex-start;
        max-height: calc(100vh - 120px);
      }
      
      .profile-sidebar::-webkit-scrollbar {
        width: 6px;
      }
      
      .profile-sidebar::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .profile-sidebar::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 3px;
      }
      
      .profile-sidebar::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.3);
      }

      /* Profile card */
      .profile-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        align-items: center;
        flex-shrink: 0;
      }

      .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-600), var(--primary-400));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        font-weight: 600;
        margin-bottom: 1rem;
        position: relative;
        flex-shrink: 0;
        box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
      }

      .profile-status-badge {
        position: absolute;
        bottom: 0;
        right: 0;
        top: auto;
        background: #10b981;
        color: white;
        font-size: 0.65rem;
        padding: 0.15rem 0.5rem;
        border-radius: 12px;
        font-weight: 600;
        text-transform: uppercase;
        border: 2px solid white;
      }

      .profile-name-section {
        text-align: center;
        margin-bottom: 1rem;
        width: 100%;
        flex-shrink: 0;
      }

      .profile-name {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        line-height: 1.2;
      }

      .profile-username {
        font-size: 0.875rem;
        color: #6b7280;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.375rem;
        line-height: 1.2;
      }

      .profile-info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-top: 1px solid rgba(229, 231, 235, 0.5);
        font-size: 0.875rem;
        width: 100%;
        flex-shrink: 0;
        line-height: 1.1;
      }

      .profile-info-item:first-of-type {
        border-top: none;
      }

      .profile-info-label {
        color: #6b7280;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
      }

      .profile-info-value {
        color: #1f2937;
        font-weight: 600;
      }

      /* Change Password Card */
      .password-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        flex-shrink: 0;
      }

      .danger-zone-card {
        background: #fef2f2;
        border: 1px solid #fecaca;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(248,113,113,0.1);
        margin-top: 1rem;
      }

      .danger-zone-title {
        font-size: 1rem;
        font-weight: 700;
        color: #b91c1c;
        margin-bottom: 0.5rem;
      }

      .danger-zone-description {
        font-size: 0.875rem;
        color: #991b1b;
        line-height: 1.5;
      }

      .password-card-title {
        font-size: 1rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.5rem;
      }

      .password-card-description {
        font-size: 0.875rem;
        color: #6b7280;
        margin-bottom: 1rem;
        line-height: 1.4;
      }

      /* Right side - complaints container */
      .complaints-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(8px);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.5);
        padding: 1.5rem;
      }

      .complaints-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(229, 231, 235, 0.5);
      }

      .complaints-title {
        font-size: 1.5rem;
        font-weight: 800;
        color: #1f2937;
        text-transform: none;
        letter-spacing: normal;
        padding-bottom: 0;
        border-bottom: none;
        background: linear-gradient(135deg, var(--primary-600), var(--primary-400));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .complaints-scroll {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding-right: 0.5rem;
      }

      .complaint-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: all 0.2s;
        border: 1px solid rgba(229, 231, 235, 0.8);
      }

      .complaint-card:hover {
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        transform: translateY(-2px);
        border-color: var(--primary-300);
      }

      .complaint-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
      }

      .complaint-title {
        font-weight: 700;
        color: #1f2937;
        font-size: 1.1rem;
        flex: 1;
        margin-right: 1rem;
      }

      .complaint-meta {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-top: 0.5rem;
      }

      .status-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .status-new { background: #dbeafe; color: #1e40af; }
      .status-assigned { background: #fef3c7; color: #92400e; }
      .status-in_progress { background: #ddd6fe; color: #5b21b6; }
      .status-pending_approval { background: #fde047; color: #713f12; }
      .status-completed { background: #d1fae5; color: #065f46; }
      .status-resolved { background: #d1fae5; color: #065f46; }
      .status-cancelled { background: #fee2e2; color: #991b1b; }
      .status-unknown { background: #e5e7eb; color: #374151; }

      .complaint-date {
        font-size: 0.875rem;
        color: #6b7280;
      }

      /* Empty state */
      .complaints-empty {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 3rem 1rem;
        text-align: center;
        color: #6b7280;
      }

      .complaints-empty.hidden {
        display: none;
      }

      /* Mobile responsiveness */
      @media (max-width: 768px) {
        .profile-content-wrapper {
          flex-direction: column;
          height: 100%;
        }

        .profile-sidebar {
          width: 100%;
          max-height: none;
          height: auto;
          min-height: 0;
          overflow: visible;
          gap: 0.5rem;
          flex-shrink: 0;
        }

        .profile-card {
          padding: 1rem;
        }

        .password-card {
          padding: 1rem;
        }

        .complaints-container {
          flex: 1;
          min-height: 0;
          overflow: hidden;
        }

        .complaints-scroll {
          min-height: 0;
        }
      }

      /* Scrollbar styling - only for complaints */
      .complaints-scroll::-webkit-scrollbar {
        width: 8px;
      }

      .complaints-scroll::-webkit-scrollbar-track {
        background: transparent;
        border-radius: 4px;
      }

      .complaints-scroll::-webkit-scrollbar-thumb {
        background: rgba(0,0,0,0.1);
        border-radius: 4px;
      }

      .complaints-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(0,0,0,0.2);
      }

      /* Edit icon */
      .edit-icon {
        cursor: pointer;
        color: #6b7280;
        opacity: 0.6;
        transition: opacity 0.2s;
        pointer-events: auto;
        user-select: none;
        -webkit-user-select: none;
        display: inline-block;
        margin-left: 0.5rem;
      }

      .edit-icon:hover {
        opacity: 1;
        color: #3b82f6;
      }

      /* Password form */
      #change-password-form {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      #change-password-form .input {
        padding: 0.625rem;
        font-size: 0.875rem;
      }

      #change-password-form button {
        padding: 0.625rem;
        font-size: 0.875rem;
        margin-top: 0.5rem;
      }

      /* Email confirmation message */
      .email-confirmation-message {
        padding: 0.75rem;
        background: #dbeafe;
        border: 1px solid #93c5fd;
        border-radius: 8px;
        color: #1e40af;
        font-size: 0.875rem;
        margin-top: 0.5rem;
      }

      /* Dark Mode Styles */
      html.dark .profile-page {
        background-color: #0f172a;
      }

      html.dark .profile-card,
      html.dark .password-card {
        background: rgba(30, 41, 59, 0.7);
        border-color: rgba(255, 255, 255, 0.05);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }

      html.dark .complaints-container {
        background: rgba(30, 41, 59, 0.4);
        border-color: rgba(255, 255, 255, 0.05);
      }

      html.dark .profile-name {
        color: #f1f5f9;
      }

      html.dark .profile-username {
        color: #94a3b8;
      }

      html.dark .profile-info-label {
        color: #94a3b8;
      }

      html.dark .profile-info-value {
        color: #f1f5f9;
      }

      html.dark .profile-info-item {
        border-top-color: rgba(255, 255, 255, 0.1);
      }
      
      html.dark .profile-sidebar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
      }
      
      html.dark .profile-sidebar::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      html.dark .password-card-title {
        color: #f1f5f9;
      }

      html.dark .password-card-description {
        color: #94a3b8;
      }

      html.dark .complaints-title {
        color: #f1f5f9;
      }

      html.dark .complaint-card {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }

      html.dark .complaint-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        border-color: #10b981;
      }

      html.dark .complaint-title {
        color: #f1f5f9;
      }

      html.dark .complaint-date {
        color: #94a3b8;
      }

      html.dark .complaints-empty {
        color: #94a3b8;
      }

      html.dark .complaints-empty h3 {
        color: #cbd5e1;
      }

      html.dark .edit-icon {
        color: #94a3b8;
      }

      html.dark .edit-icon:hover {
        color: #cbd5e1;
      }

      html.dark .email-confirmation-message {
        background: #1e3a8a;
        border-color: #3b82f6;
        color: #93c5fd;
      }

      html.dark .complaints-scroll::-webkit-scrollbar-track {
        background: transparent;
      }

      html.dark .complaints-scroll::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
      }

      html.dark .complaints-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      html.dark #address-section {
        border-top-color: rgba(255, 255, 255, 0.1);
      }

      html.dark #address-section span {
        color: #cbd5e1;
      }

      html.dark #address-section button {
        background: #334155;
        color: #cbd5e1;
        border-color: #475569;
      }

      html.dark #address-section button:hover {
        background: #475569;
        border-color: #64748b;
      }

      html.dark #address-section div[style*="color: #374151"] {
        color: #cbd5e1 !important;
      }

      html.dark #address-section div[style*="color: #1f2937"] {
        color: #f1f5f9 !important;
      }

      html.dark #address-edit .input,
      html.dark #profile-name-edit .input,
      html.dark #profile-mobile-edit .input {
        background: #0f172a;
        border-color: #334155;
        color: #f1f5f9;
      }

      html.dark #address-edit .input::placeholder,
      html.dark #profile-name-edit .input::placeholder,
      html.dark #profile-mobile-edit .input::placeholder {
        color: #64748b;
      }

      html.dark #address-edit .input:focus,
      html.dark #profile-name-edit .input:focus,
      html.dark #profile-mobile-edit .input:focus {
        border-color: #60a5fa;
        box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
      }

      html.dark #change-password-form .input {
        background: #0f172a;
        border-color: #334155;
        color: #f1f5f9;
      }

      html.dark #change-password-form .input::placeholder {
        color: #64748b;
      }

      html.dark #change-password-form .input:focus {
        border-color: #60a5fa;
        box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
      }

      html.dark #change-password-form button {
        background: #3b82f6;
        color: white;
      }

      html.dark #change-password-form button:hover {
        background: #2563eb;
      }

      html.dark #edit-address-btn,
      html.dark #save-name-btn,
      html.dark #cancel-name-btn,
      html.dark #save-mobile-btn,
      html.dark #cancel-mobile-btn,
      html.dark #save-address-btn,
      html.dark #cancel-address-btn {
        background: #334155;
        color: #cbd5e1;
        border-color: #475569;
      }

      html.dark #edit-address-btn:hover,
      html.dark #save-name-btn:hover,
      html.dark #cancel-name-btn:hover,
      html.dark #save-mobile-btn:hover,
      html.dark #cancel-mobile-btn:hover,
      html.dark #save-address-btn:hover,
      html.dark #cancel-address-btn:hover {
        background: #475569;
        border-color: #64748b;
      }

      html.dark #action-button {
        background: #334155;
        color: #cbd5e1;
        border-color: #475569;
      }

      html.dark #action-button:hover {
        background: #475569;
        border-color: #64748b;
      }

      html.dark #current-email-display {
        color: #f1f5f9;
      }

      html.dark .input {
        background: #0f172a;
        border-color: #334155;
        color: #f1f5f9;
      }

      html.dark .input::placeholder {
        color: #64748b;
      }

      html.dark .input:focus {
        border-color: #60a5fa;
        box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
      }

      html.dark .btn-primary {
        background: #3b82f6;
        color: white;
      }

      html.dark .btn-primary:hover {
        background: #2563eb;
      }

      html.dark .btn-secondary {
        background: #334155;
        color: #cbd5e1;
        border-color: #475569;
      }

      html.dark .btn-secondary:hover {
        background: #475569;
        border-color: #64748b;
      }

      /* Status badges dark mode */
      html.dark .status-new { background: #1e3a8a; color: #93c5fd; }
      html.dark .status-assigned { background: #78350f; color: #fbbf24; }
      html.dark .status-in_progress { background: #581c87; color: #c4b5fd; }
      html.dark .status-pending_approval { background: #78350f; color: #fde047; }
      html.dark .status-completed { background: #064e3b; color: #34d399; }
      html.dark .status-resolved { background: #064e3b; color: #34d399; }
      html.dark .status-cancelled { background: #7f1d1d; color: #fca5a5; }
      html.dark .status-unknown { background: #334155; color: #94a3b8; }
    </style>
  </head>
  <body>
    <div class="app-container">
        <div class="header-container"></div>
        <div id="sidebar" class="collapsible"></div>
        <div id="dashboard-clock" class="dashboard-clock" aria-live="polite"></div>
        <div id="app" class="collapsible">
          <div class="profile-page">
            <div class="profile-content-wrapper">
              <!-- Left Sidebar - Compact Profile -->
              <div class="profile-sidebar">
                <!-- Profile Card -->
                <div class="profile-card">
                  <div class="profile-avatar">
                    <div id="profile-initial">‚Äî</div>
                    <div class="profile-status-badge">Online</div>
                  </div>
                  <div class="profile-name-section">
                    <div class="profile-name">
                      <span id="profile-name-display">Loading...</span>
                      <span class="edit-icon" id="edit-name-icon" title="Edit name">‚úèÔ∏è</span>
                      <div id="profile-name-edit" style="display: none; width: 100%; flex-direction: column; gap: 0.5rem; margin-top: 0.5rem;">
                        <input id="edit-first-name-input" class="input" type="text" placeholder="First Name" style="padding: 0.375rem; font-size: 0.8125rem; width: 100%;">
                        <input id="edit-middle-name-input" class="input" type="text" placeholder="Middle Name (optional)" style="padding: 0.375rem; font-size: 0.8125rem; width: 100%;">
                        <input id="edit-last-name-input" class="input" type="text" placeholder="Last Name" style="padding: 0.375rem; font-size: 0.8125rem; width: 100%;">
                        <div style="display: flex; gap: 0.25rem; margin-top: 0.25rem;">
                          <button class="btn-secondary" id="save-name-btn" style="padding: 0.375rem 0.5rem; font-size: 0.75rem; flex: 1;">Save</button>
                          <button class="btn-secondary" id="cancel-name-btn" style="padding: 0.375rem 0.5rem; font-size: 0.75rem; flex: 1;">Cancel</button>
                        </div>
                      </div>
                    </div>
                    <div class="profile-username">
                      <span id="profile-email-display">Loading...</span>
                      <span class="edit-icon" id="edit-email-icon" title="Edit email">‚úèÔ∏è</span>
                    </div>
                  </div>
                  <div style="width: 100%;">
                    <div class="profile-info-item">
                      <span class="profile-info-label">üë§ Member since</span>
                      <span class="profile-info-value" id="member-since">‚Äî</span>
                    </div>
                    <div class="profile-info-item">
                      <span class="profile-info-label">üì± Mobile</span>
                      <span class="profile-info-value">
                        <span id="profile-mobile-display">‚Äî</span>
                        <span class="edit-icon" id="edit-mobile-icon" title="Edit mobile" style="margin-left: 0.5rem;">‚úèÔ∏è</span>
                        <div id="profile-mobile-edit" style="display: none; margin-top: 0.25rem;">
                          <input id="edit-mobile-input" class="input" type="tel" style="padding: 0.25rem; font-size: 0.75rem; width: calc(100% - 4rem);">
                          <button class="btn-secondary" id="save-mobile-btn" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; margin-left: 0.25rem;">Save</button>
                          <button class="btn-secondary" id="cancel-mobile-btn" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; margin-left: 0.25rem;">Cancel</button>
                        </div>
                      </span>
                    </div>
                    <div class="profile-info-item">
                      <span class="profile-info-label">üë§ Role</span>
                      <span class="profile-info-value" id="profile-role">‚Äî</span>
                    </div>
                    <div class="profile-info-item" id="profile-office-item" style="display: none;">
                      <span class="profile-info-label">üè¢ Office</span>
                      <span class="profile-info-value" id="profile-office">‚Äî</span>
                    </div>
                    <div class="profile-info-item" id="profile-position-id-item" style="display: none;">
                      <span class="profile-info-label">üÜî Position ID</span>
                      <span class="profile-info-value" id="profile-position-id">‚Äî</span>
                    </div>
                    <div class="profile-info-item">
                      <span class="profile-info-label">üìÖ Available</span>
                      <span class="profile-info-value">Yes</span>
                    </div>
                  </div>
                  <!-- Address Section -->
                  <div id="address-section" style="width: 100%; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #e5e7eb;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                      <span style="font-size: 0.875rem; font-weight: 600; color: #1f2937;">Address</span>
                      <button id="edit-address-btn" class="btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Edit Address</button>
                    </div>
                    <div id="address-display">
                      <div style="font-size: 0.75rem; color: #374151; margin-bottom: 0.25rem;">
                        <span id="address-line-1-display">‚Äî</span>
                      </div>
                      <div style="font-size: 0.75rem; color: #374151; margin-bottom: 0.25rem;">
                        <span id="address-line-2-display" style="display: none;">‚Äî</span>
                      </div>
                      <div style="font-size: 0.75rem; color: #374151; margin-top: 0.25rem;">
                        <span id="address-barangay-display">‚Äî</span>
                      </div>
                    </div>
                    <div id="address-edit" style="display: none; flex-direction: column; gap: 0.375rem;">
                      <input id="edit-address-line-1" class="input" type="text" placeholder="Address Line 1" style="padding: 0.5rem; font-size: 0.8125rem;">
                      <input id="edit-address-line-2" class="input" type="text" placeholder="Address Line 2 (optional)" style="padding: 0.5rem; font-size: 0.8125rem;">
                      <select id="edit-address-barangay" class="input" style="padding: 0.5rem; font-size: 0.8125rem;">
                        <option value="">Select barangay</option>
                        <option value="Aplaya">Aplaya</option>
                        <option value="Balabag">Balabag</option>
                        <option value="Binaton">Binaton</option>
                        <option value="Cogon">Cogon</option>
                        <option value="Colorado">Colorado</option>
                        <option value="Dawis">Dawis</option>
                        <option value="Dulangan">Dulangan</option>
                        <option value="Goma">Goma</option>
                        <option value="Igpit">Igpit</option>
                        <option value="Kiagot">Kiagot</option>
                        <option value="Lungag">Lungag</option>
                        <option value="Mahayahay">Mahayahay</option>
                        <option value="Matti">Matti</option>
                        <option value="Kapatagan (Rizal)">Kapatagan (Rizal)</option>
                        <option value="Ruparan">Ruparan</option>
                        <option value="San Agustin">San Agustin</option>
                        <option value="San Jose (Balutakay)">San Jose (Balutakay)</option>
                        <option value="San Miguel (Odaca)">San Miguel (Odaca)</option>
                        <option value="San Roque">San Roque</option>
                        <option value="Sinawilan">Sinawilan</option>
                        <option value="Soong">Soong</option>
                        <option value="Tiguman">Tiguman</option>
                        <option value="Tres de Mayo">Tres de Mayo</option>
                        <option value="Zone 1 (Pob.)">Zone 1 (Pob.)</option>
                        <option value="Zone 2 (Pob.)">Zone 2 (Pob.)</option>
                        <option value="Zone 3 (Pob.)">Zone 3 (Pob.)</option>
                      </select>
                      <div style="display: flex; gap: 0.25rem;">
                        <button class="btn-secondary" id="save-address-btn" style="padding: 0.5rem; font-size: 0.8125rem; flex: 1;">Save</button>
                        <button class="btn-secondary" id="cancel-address-btn" style="padding: 0.5rem; font-size: 0.8125rem; flex: 1;">Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Change Password Card -->
                <div class="password-card">
                  <div class="password-card-title">Change Password</div>
                  <div class="password-card-description">Update your account password. You'll receive a confirmation email.</div>
                  <button id="open-password-change-modal" class="btn-primary" style="width: 100%; margin-top: 0.75rem;">Change Password</button>
                </div>

                <!-- Danger Zone -->
                <div class="danger-zone-card">
                  <div class="danger-zone-title">Delete Account</div>
                  <p class="danger-zone-description">
                    Permanently remove your CitizenLink account, sessions, and personal data. This action cannot be undone.
                    Your filed complaints stay for auditing but will no longer contain your personal details.
                  </p>
                  <button id="open-delete-account" class="btn-secondary" style="width: 100%; margin-top: 0.5rem; background: #dc2626; color: #fff; border-color: #b91c1c;">
                    Delete My Account
                  </button>
                </div>
              </div>

              <!-- Right Side - Complaints/Assignments Container -->
              <div class="complaints-container">
                <div class="complaints-header">
                  <h2 class="complaints-title" id="content-title">Active Complaints</h2>
                  <a href="/citizen/fileComplaint" class="btn-secondary" id="action-button" style="display: none;">File a complaint</a>
                </div>
                <div class="complaints-scroll" id="complaints-scroll">
                  <div id="my-complaints"></div>
                  <div id="complaints-empty" class="complaints-empty hidden">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìù</div>
                    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: #1f2937;" id="empty-title">No complaints yet</h3>
                    <p style="margin-bottom: 1rem;" id="empty-message">You haven't filed any complaints yet. Click "File a complaint" to get started!</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
    <div id="toast-container" class="toast-container"></div>

    <!-- Delete Account Modal -->
    <div id="delete-account-modal" class="modal-overlay" style="display: none; visibility: hidden;">
      <div class="modal-content" style="max-width: 460px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h2 style="margin: 0; font-size: 1.15rem; font-weight: 600; color: #991b1b;">Delete Account</h2>
          <button id="delete-account-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280;">&times;</button>
        </div>
        <div style="background:#fef2f2; border:1px solid #fecaca; border-radius:8px; padding:0.75rem; color:#991b1b; font-size:0.875rem; margin-bottom:1rem;">
          This will permanently delete your account. Sessions will be terminated immediately and personal information will be removed from the system.
        </div>
        <form id="delete-account-form">
          <div style="margin-bottom: 1rem;">
            <label style="display:block; margin-bottom:0.5rem; font-size:0.85rem; color:#374151; font-weight:500;">
              Type your email (<span id="delete-account-email-hint">‚Äî</span>) to confirm:
            </label>
            <input id="delete-account-confirm-input" class="input" type="text" placeholder="you@example.com" required>
          </div>
          <div style="margin-bottom: 1rem;">
            <label style="display:block; margin-bottom:0.5rem; font-size:0.85rem; color:#374151; font-weight:500;">Reason for deletion</label>
            <textarea id="delete-account-reason" class="input" rows="3" placeholder="Optional but helps us understand your request" style="min-height:90px;"></textarea>
            <small style="color:#6b7280;">At least 10 characters. This is kept only for audit logs.</small>
          </div>
          <label style="display:flex; gap:0.5rem; align-items:flex-start; font-size:0.85rem; color:#374151; margin-bottom:1rem;">
            <input type="checkbox" id="delete-account-ack" style="margin-top:0.2rem;">
            <span>I understand this action is permanent and that my complaints will be anonymized but kept for record-keeping.</span>
          </label>
          <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
            <button type="submit" id="delete-account-submit" class="btn-primary" style="flex:1; background:#dc2626; border-color:#b91c1c;">Delete My Account</button>
            <button type="button" id="cancel-delete-account" class="btn-secondary" style="flex:1;">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Email Change Modal -->
    <div id="email-change-modal" class="modal-overlay" style="display: none; visibility: hidden;">
      <div class="modal-content" style="max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h2 style="margin: 0; font-size: 1.25rem; font-weight: 600; color: #1f2937;">Change Email Address</h2>
          <button id="close-email-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280;">&times;</button>
        </div>
        <div style="margin-bottom: 1rem;">
          <p style="margin: 0 0 0.5rem; font-size: 0.875rem; color: #6b7280;">Current email:</p>
          <p style="margin: 0; font-size: 0.9375rem; color: #1f2937; font-weight: 500;" id="current-email-display">‚Äî</p>
        </div>
        <form id="email-change-form">
          <div style="margin-bottom: 1rem;">
            <label for="new-email-input" style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: #374151; font-weight: 500;">New email address:</label>
            <input id="new-email-input" class="input" type="email" placeholder="Enter new email" required style="width: 100%; padding: 0.5rem; font-size: 0.875rem;">
          </div>
          <div style="margin-bottom: 1rem;">
            <label for="current-password-email" style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: #374151; font-weight: 500;">Current password:</label>
            <input id="current-password-email" class="input" type="password" placeholder="Enter your current password" required autocomplete="current-password" style="width: 100%; padding: 0.5rem; font-size: 0.875rem;">
          </div>
          <div style="padding: 0.75rem; background-color: #fffbeb; border-left: 4px solid #f59e0b; border-radius: 4px; margin-bottom: 1rem;">
            <p style="margin: 0; font-size: 0.8125rem; color: #92400e; line-height: 1.5;">
              <strong>Note:</strong> A verification email will be sent to your new email address to confirm this change. You must click the confirmation link in that email to complete the email change.
            </p>
          </div>
          <div style="display: flex; gap: 0.5rem;">
            <button type="submit" class="btn-primary" style="flex: 1; padding: 0.5rem; font-size: 0.875rem;">Request Email Change</button>
            <button type="button" id="cancel-email-modal" class="btn-secondary" style="flex: 1; padding: 0.5rem; font-size: 0.875rem;">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Password Change Modal -->
    <div id="password-change-modal" class="modal-overlay" style="display: none; visibility: hidden;">
      <div class="modal-content" style="max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h2 style="margin: 0; font-size: 1.25rem; font-weight: 600; color: #1f2937;">Change Password</h2>
          <button id="close-password-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280;">&times;</button>
        </div>
        <form id="change-password-form">
          <div style="margin-bottom: 1rem;">
            <label for="current-password" style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: #374151; font-weight: 500;">Current password:</label>
            <input id="current-password" class="input" type="password" placeholder="Enter your current password" required autocomplete="current-password" style="width: 100%; padding: 0.5rem; font-size: 0.875rem;">
          </div>
          <div style="margin-bottom: 1rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" id="logout-all-devices" style="width: 18px; height: 18px; cursor: pointer;">
              <span style="font-size: 0.875rem; color: #374151;">Log out from all devices and sessions</span>
            </label>
            <p style="margin: 0.5rem 0 0 1.75rem; font-size: 0.75rem; color: #6b7280;">If checked, you'll be logged out from all devices after changing your password.</p>
          </div>
          <div style="padding: 0.75rem; background-color: #fffbeb; border-left: 4px solid #f59e0b; border-radius: 4px; margin-bottom: 1rem;">
            <p style="margin: 0; font-size: 0.8125rem; color: #92400e; line-height: 1.5;">
              <strong>Note:</strong> A confirmation email will be sent to your email address. You must click the confirmation link in that email to set your new password.
            </p>
          </div>
          <div style="display: flex; gap: 0.75rem;">
            <button type="button" id="cancel-password-change" class="btn-secondary" style="flex: 1; padding: 0.625rem;">Cancel</button>
            <button type="submit" class="btn-primary" style="flex: 1; padding: 0.625rem;">Request Password Change</button>
          </div>
          <div id="password-confirmation-message" style="margin-top: 1rem; padding: 0.75rem; background-color: #ecfdf5; border-left: 4px solid #10b981; border-radius: 4px; display: none;">
            <p style="margin: 0; font-size: 0.8125rem; color: #065f46; line-height: 1.5;"></p>
          </div>
        </form>
      </div>
    </div>

    <style>
      .modal-overlay {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        background-color: rgba(0, 0, 0, 0.6) !important;
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        display: flex !important;
        align-items: center;
        justify-content: center;
        z-index: 10002 !important;
        visibility: visible !important;
        opacity: 1 !important;
        pointer-events: auto !important;
      }
      
      .modal-overlay[style*="display: none"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        pointer-events: none !important;
      }
      .modal-content {
        background: white !important;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 8px 24px rgba(0, 0, 0, 0.2);
        width: 90%;
        max-width: 500px;
        position: relative;
        z-index: 10003;
        visibility: visible !important;
        opacity: 1 !important;
        pointer-events: auto !important;
        transform: scale(1);
        animation: modalFadeIn 0.2s ease-out;
      }
      
      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      
      .modal-content .input {
        background: white;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        padding: 0.5rem;
        font-size: 0.875rem;
        color: #1f2937;
        width: 100%;
        box-sizing: border-box;
      }
      
      .modal-content .input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .modal-content button {
        cursor: pointer;
      }
      .inline-edit-loading {
        opacity: 0.6;
        pointer-events: none;
      }

      /* Dark Mode for Modal */
      html.dark .modal-overlay {
        background-color: rgba(0, 0, 0, 0.7);
      }

      html.dark .modal-content {
        background: #1e293b;
        border-color: #334155;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      }

      html.dark .modal-content h2 {
        color: #f1f5f9;
      }

      html.dark .modal-content p {
        color: #cbd5e1;
      }

      html.dark .modal-content label {
        color: #cbd5e1;
      }

      html.dark .modal-content .input {
        background: #0f172a;
        border-color: #334155;
        color: #f1f5f9;
      }

      html.dark .modal-content .input::placeholder {
        color: #64748b;
      }

      html.dark .modal-content .input:focus {
        border-color: #60a5fa;
        box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
      }

      html.dark .modal-content div[style*="background-color: #fffbeb"] {
        background-color: #78350f !important;
        border-left-color: #f59e0b !important;
      }

      html.dark .modal-content div[style*="background-color: #fffbeb"] p {
        color: #fde047 !important;
      }
    </style>

    <script type="module" src="../js/components/header.js"></script>
    <script type="module" src="../js/components/sidebar.js"></script>
    <script type="module" src="../js/utils/passwordToggle.js"></script>
    <script type="module" src="../js/auth/authChecker.js"></script>
    <script type="module" src="../js/components/clock.js"></script>
    <script type="module" src="../js/pages/myProfile.js"></script>
  </body>
</html>
